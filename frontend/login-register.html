<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>EcoPulse - Login / Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" />
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      background: #f5f7fa;
      color: #2C3E50;
      height: 100vh;
      display: flex;
      font-size: 14px;
      justify-content: center;
      align-items: center;
      background-color: #f0fdf6;
    }
    .form-container {
      background-color: white;
      padding: 40px 60px;
      border-radius: 8px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
    }
    .form-container h2 {
      margin-bottom: 20px;
      color: #00C98D;
    }
    .form-group {
      margin-bottom: 12px;
    }
    .form-group label {
      font-weight: bold;
    }
    .form-group input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .container {
      display: flex;
      width: 100%;
      height: 100vh;
    }

    .form-section {
      flex: 1;
      padding: 30px 25px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: #fff;
      border-right: 1px solid #eee;
      overflow-y: auto;
    }

    .form-section h2 {
      font-size: 20px;
      margin-bottom: 16px;
      color: #00C98D;
    }

    .form-group {
      margin-bottom: 12px;
      position: relative;
    }

    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 600;
      font-size: 13px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
    }

    .form-group .gender-options {
      display: flex;
      gap: 15px;
      margin-top: 5px;
      font-size: 13px;
    }

    .form-section button,
    .right-section button {
      background: #00C98D;
      color: #fff;
      padding: 10px;
      border: none;
      width: 100%;
      border-radius: 6px;
      font-weight: bold;
      font-size: 13px;
      margin-top: 8px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .form-section button:hover,
    .right-section button:hover {
      background: #00b383;
    }

    .right-section {
      background: #e9fef7;
      flex: 1;
      padding: 30px 25px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow-y: auto;
    }

    .right-section h2 {
      font-size: 20px;
      margin-bottom: 16px;
      color: #00C98D;
    }

    .toggle-password {
      position: absolute;
      right: 10px;
      top: 32px;
      cursor: pointer;
      color: #999;
    }

    .strength {
      font-size: 11px;
      margin-top: 3px;
      color: gray;
    }

    .match-status {
      font-size: 12px;
      color: red;
      margin-top: 2px;
    }

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .form-section, .right-section {
        border-right: none;
        border-bottom: 1px solid #eee;
        padding: 25px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Login Section -->
    <div class="form-section">
      <h2>Login to EcoPulse</h2>
      <form id="loginForm">
        <div class="form-group">
          <label for="loginEmail">Email</label>
          <input type="email" id="loginEmail" placeholder="Enter your email" required />
        </div>
        <div class="form-group">
          <label for="loginPassword">Password</label>
          <input type="password" id="loginPassword" placeholder="Enter your password" required />
          <i class="fas fa-eye toggle-password" toggle="loginPassword"></i>
        </div>
        <button type="submit" id="loginBtn">Login</button>
      </form>
    </div>

    <!-- Register Section -->
    <div class="right-section">
      <h2>Register for EcoPulse</h2>
      <form id="registerForm">
        <div class="form-group"><label for="registerName">Name</label><input id="registerName" type="text" placeholder="Full Name" required /></div>
        <div class="form-group"><label for="registerEmail">Email</label><input id="registerEmail" type="email" placeholder="Email Address" required /></div>

        <div class="form-group">
          <label for="registerPassword">Password</label>
          <input id="registerPassword" type="password" placeholder="Choose a password" required />
          <i class="fas fa-eye toggle-password" toggle="registerPassword"></i>
          <div class="strength" id="passwordStrength"></div>
        </div>

        <div class="form-group">
          <label for="registerConfirmPassword">Confirm Password</label>
          <input id="registerConfirmPassword" type="password" placeholder="Confirm your password" required />
          <i class="fas fa-eye toggle-password" toggle="registerConfirmPassword"></i>
          <div class="match-status" id="matchStatus"></div>
        </div>

        <div class="form-group"><label for="registerPhone">Phone</label><input id="registerPhone" type="tel" placeholder="Phone Number" required /></div>

        <div class="form-group">
          <label for="registerCountry">Country</label>
          <select id="registerCountry" required>
            <option value="">Select Country</option>
            <option value="USA">United States</option>
            <option value="Canada">Canada</option>
            <option value="India">India</option>
            <option value="Australia">Australia</option>
            <option value="Germany">Germany</option>
            <option value="UK">United Kingdom</option>
            <option value="France">France</option>
            <option value="Japan">Japan</option>
          </select>
        </div>

        <div class="form-group">
          <label for="registerOccupation">Occupation</label>
          <select id="registerOccupation" required>
            <option value="">Select Occupation</option>
            <option value="Engineer">Engineer</option>
            <option value="Teacher">Teacher</option>
            <option value="Doctor">Doctor</option>
            <option value="Designer">Designer</option>
            <option value="Student">Student</option>
            <option value="Developer">Developer</option>
            <option value="Manager">Manager</option>
            <option value="Other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label>Gender</label>
          <div class="gender-options">
            <label><input type="radio" name="gender" value="Male" required /> Male</label>
            <label><input type="radio" name="gender" value="Female" required /> Female</label>
            <label><input type="radio" name="gender" value="Other" required /> Other</label>
          </div>
        </div>

        <button type="submit" id="registerBtn">Register</button>
      </form>
    </div>
  </div>

  <script>
    function validateEmail(email) {
      return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function validatePhone(phone) {
      return /^\d{10}$/.test(phone);
    }

    // Toggle password visibility
    document.querySelectorAll(".toggle-password").forEach(icon => {
      icon.addEventListener("click", () => {
        const inputId = icon.getAttribute("toggle");
        const input = document.getElementById(inputId);
        input.type = input.type === "password" ? "text" : "password";
        icon.classList.toggle("fa-eye-slash");
      });
    });

    // Password strength
    const passwordField = document.getElementById("registerPassword");
    const strengthText = document.getElementById("passwordStrength");
    passwordField.addEventListener("input", () => {
      const val = passwordField.value;
      if (val.length < 6) {
        strengthText.textContent = "Weak (min 6 characters)";
        strengthText.style.color = "red";
      } else if (!/[A-Z]/.test(val) || !/[0-9]/.test(val)) {
        strengthText.textContent = "Moderate (add uppercase & numbers)";
        strengthText.style.color = "orange";
      } else {
        strengthText.textContent = "Strong password";
        strengthText.style.color = "green";
      }
    });

    // Confirm password match
    const confirmField = document.getElementById("registerConfirmPassword");
    const matchStatus = document.getElementById("matchStatus");
    confirmField.addEventListener("input", () => {
      if (confirmField.value !== passwordField.value) {
        matchStatus.textContent = "Passwords do not match";
      } else {
        matchStatus.textContent = "";
      }
    });

    // Login form handler
    document.getElementById("loginForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value.trim();

      if (!validateEmail(email)) return alert("Enter a valid email.");
      if (password.length < 6) return alert("Password must be at least 6 characters.");

      fetch('http://localhost:5000/api/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) window.location.href = "index.html";
        else alert("Login failed: " + data.message);
      })
      .catch(err => alert("Login error. Try again later."));
    });

    // Register form handler
    document.getElementById("registerForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const name = document.getElementById("registerName").value.trim();
      const email = document.getElementById("registerEmail").value.trim();
      const password = passwordField.value.trim();
      const confirmPassword = confirmField.value.trim();
      const phone = document.getElementById("registerPhone").value.trim();
      const country = document.getElementById("registerCountry").value.trim();
      const occupation = document.getElementById("registerOccupation").value.trim();
      const gender = document.querySelector('input[name="gender"]:checked');

      if (!name || !email || !password || !confirmPassword || !phone || !country || !occupation || !gender) {
        return alert("Please fill out all fields.");
      }

      if (!validateEmail(email)) return alert("Enter a valid email.");
      if (!validatePhone(phone)) return alert("Phone number must be 10 digits.");
      if (password.length < 6) return alert("Password must be at least 6 characters.");
      if (password !== confirmPassword) return alert("Passwords do not match.");

      const userData = {
        name, email, password, phone, country, occupation, gender: gender.value
      };

      fetch('http://localhost:5000/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          alert("Registration successful!");
          document.getElementById("registerForm").reset();
        } else {
          alert("Registration failed: " + data.message);
        }
      })
      .catch(err => alert("Something went wrong. Try again later."));
    });

    // Toggle between login and register forms
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginLink = document.querySelector('.toggle-link[href="login-register.html#login"]');
    const registerLink = document.querySelector('.toggle-link[href="login-register.html#register"]');
    const registerSection = document.getElementById('register');

    registerLink.addEventListener('click', () => {
      loginForm.style.display = 'none';
      registerSection.style.display = 'block';
    });

    loginLink.addEventListener('click', () => {
      registerSection.style.display = 'none';
      loginForm.style.display = 'block';
    });

    // Handle login form submission
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      // Save user data to localStorage and redirect to profile page
      localStorage.setItem('user', JSON.stringify({
        name: "John Doe",
        email: email,
        avatar: "img/default_avatar.png"
      }));

      window.location.href = 'profile.html';  // Redirect to profile page
    });

    // Handle register form submission
    registerForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = document.getElementById('registerName').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;

      // Save new user data to localStorage and redirect to profile page
      localStorage.setItem('user', JSON.stringify({
        name: name,
        email: email,
        avatar: "img/default_avatar.png"
      }));

      window.location.href = 'profile.html';  // Redirect to profile page
    });
  </script>
</body>
</html>
